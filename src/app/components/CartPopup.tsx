"use client";
import Image from "next/image";
import CartPopupProductDescription from "./CartPopupProductDescription";
import { useCartStore } from "@/lib/stores/cart-store";

export default function CartPopup() {
  const { selectedItem } = useCartStore();
  const clearSelectedItem = useCartStore((state) => state.clearSelectedItem);

  console.log(selectedItem);

  return (
    <div
      className="lg:hidden fixed bottom-0 w-full shadow-2xl pb-[5rem] z-50 rounded-t-2xl bg-white h-[80vh] overflow-clip overflow-y-auto"
      onScroll={(e) => e.stopPropagation()}
    >
      <div className="p-4 sticky top-0 rounded-t-2xl z-40 bg-white">
        <div className="flex items-center justify-between">
          <svg
            width="65"
            height="65"
            className="size-8"
            viewBox="0 0 65 65"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              cx="32.5"
              cy="32.5"
              r="30.5"
              fill="white"
              stroke="#FF008C"
              stroke-width="4"
            />
            <path
              d="M30.4472 31.7869C30.4206 31.654 30.3552 31.5308 30.2579 31.4336C30.1281 31.3037 29.9521 31.2307 29.7685 31.2307C29.5849 31.2307 29.4089 31.3037 29.279 31.4336C29.1492 31.5634 29.0762 31.7394 29.0762 31.9231C29.0762 32.1067 29.1492 32.2827 29.279 32.4125C29.4089 32.5424 29.5849 32.6154 29.7685 32.6154C29.9521 32.6154 30.1281 32.5424 30.2579 32.4125C30.3877 32.2827 30.4607 32.1067 30.4607 31.9231L30.4472 31.7869ZM37.8446 31.9231C37.8446 31.7394 37.7717 31.5634 37.6418 31.4336C37.512 31.3037 37.336 31.2307 37.1524 31.2307C36.9688 31.2307 36.7928 31.3037 36.663 31.4336C36.5331 31.5634 36.4602 31.7394 36.4602 31.9231L36.4737 32.0592C36.5003 32.1921 36.5657 32.3153 36.663 32.4125C36.7928 32.5424 36.9688 32.6154 37.1524 32.6154C37.336 32.6154 37.512 32.5424 37.6418 32.4125C37.7717 32.2827 37.8446 32.1067 37.8446 31.9231ZM24.4955 16.0286C24.8621 15.9202 25.2469 16.1291 25.3554 16.4956L25.8638 18.2156H39.3896C41.0886 18.2156 42.3853 19.7996 41.8953 21.4563L40.3684 26.6252C40.042 27.7264 39.0097 28.4615 37.8627 28.4615H29.4106C28.2631 28.4615 27.2295 27.7262 26.904 26.6252L24.683 19.1035L24.6839 19.1026L24.0286 16.8886C23.9202 16.5221 24.1291 16.1372 24.4955 16.0286ZM28.2317 26.2322C28.375 26.717 28.847 27.0768 29.4106 27.0768H37.8627C38.425 27.0768 38.8964 26.7187 39.0407 26.2322L40.5676 21.0633L40.5974 20.9307C40.706 20.2682 40.1814 19.6002 39.3896 19.6002H26.2739L28.2317 26.2322ZM31.8353 32.1286C31.788 32.604 31.5775 33.0508 31.2368 33.3915C30.8473 33.781 30.3193 34 29.7685 34C29.2177 34 28.6896 33.781 28.3002 33.3915C27.9107 33.002 27.6918 32.4739 27.6918 31.9231C27.6918 31.3722 27.9107 30.8441 28.3002 30.4546C28.6896 30.0651 29.2177 29.8461 29.7685 29.8461C30.3193 29.8461 30.8473 30.0651 31.2368 30.4546C31.6263 30.8441 31.8452 31.3722 31.8452 31.9231L31.8353 32.1286ZM39.2291 31.9231C39.2291 32.4739 39.0102 33.002 38.6207 33.3915C38.2312 33.781 37.7032 34 37.1524 34C36.6016 34 36.0735 33.781 35.6841 33.3915C35.3434 33.0508 35.1328 32.604 35.0856 32.1286L35.0757 31.9231C35.0757 31.3722 35.2946 30.8441 35.6841 30.4546C36.0735 30.0651 36.6016 29.8461 37.1524 29.8461C37.7032 29.8461 38.2312 30.0651 38.6207 30.4546C39.0102 30.8441 39.2291 31.3722 39.2291 31.9231Z"
              fill="#FF008C"
            />
            <path
              d="M19.6185 42.3478C19.6185 41.4414 19.8229 40.6283 20.2317 39.9084C20.6405 39.1797 21.1959 38.611 21.898 38.2022C22.6089 37.7934 23.3954 37.589 24.2574 37.589C25.2704 37.589 26.1547 37.8334 26.91 38.3222C27.6654 38.8109 28.2164 39.5041 28.563 40.4016H27.11C26.8523 39.8418 26.479 39.4108 25.9903 39.1086C25.5104 38.8065 24.9327 38.6554 24.2574 38.6554C23.6086 38.6554 23.0266 38.8065 22.5111 39.1086C21.9957 39.4108 21.5914 39.8418 21.2981 40.4016C21.0048 40.9526 20.8582 41.6013 20.8582 42.3478C20.8582 43.0854 21.0048 43.7341 21.2981 44.294C21.5914 44.845 21.9957 45.2715 22.5111 45.5737C23.0266 45.8758 23.6086 46.0269 24.2574 46.0269C24.9327 46.0269 25.5104 45.8803 25.9903 45.587C26.479 45.2849 26.8523 44.8539 27.11 44.294H28.563C28.2164 45.1827 27.6654 45.8714 26.91 46.3602C26.1547 46.84 25.2704 47.08 24.2574 47.08C23.3954 47.08 22.6089 46.88 21.898 46.4801C21.1959 46.0713 20.6405 45.507 20.2317 44.7872C19.8229 44.0674 19.6185 43.2543 19.6185 42.3478ZM29.5074 43.3209C29.5074 42.5744 29.6585 41.9213 29.9606 41.3614C30.2628 40.7927 30.676 40.3528 31.2003 40.0417C31.7335 39.7307 32.3245 39.5752 32.9732 39.5752C33.6131 39.5752 34.1685 39.7129 34.6395 39.9884C35.1105 40.2639 35.4615 40.6105 35.6925 41.0282V39.6952H36.9189V47H35.6925V45.6403C35.4526 46.0669 35.0927 46.4224 34.6128 46.7067C34.1418 46.9822 33.5908 47.12 32.9599 47.12C32.3112 47.12 31.7246 46.96 31.2003 46.6401C30.676 46.3202 30.2628 45.8714 29.9606 45.2938C29.6585 44.7161 29.5074 44.0585 29.5074 43.3209ZM35.6925 43.3342C35.6925 42.7833 35.5815 42.3034 35.3593 41.8946C35.1371 41.4858 34.835 41.1748 34.4529 40.9615C34.0796 40.7393 33.6664 40.6283 33.2132 40.6283C32.7599 40.6283 32.3467 40.7349 31.9735 40.9482C31.6002 41.1615 31.3025 41.4725 31.0804 41.8813C30.8582 42.2901 30.7471 42.7699 30.7471 43.3209C30.7471 43.8808 30.8582 44.3695 31.0804 44.7872C31.3025 45.196 31.6002 45.5115 31.9735 45.7336C32.3467 45.9469 32.7599 46.0536 33.2132 46.0536C33.6664 46.0536 34.0796 45.9469 34.4529 45.7336C34.835 45.5115 35.1371 45.196 35.3593 44.7872C35.5815 44.3695 35.6925 43.8852 35.6925 43.3342ZM39.7738 40.8815C39.9871 40.4639 40.2893 40.1395 40.6803 39.9084C41.0802 39.6774 41.5645 39.5619 42.1332 39.5619V40.8149H41.8133C40.4537 40.8149 39.7738 41.5525 39.7738 43.0277V47H38.5608V39.6952H39.7738V40.8815ZM44.6052 40.6949V45.0005C44.6052 45.356 44.6807 45.6092 44.8318 45.7603C44.9828 45.9025 45.245 45.9736 45.6182 45.9736H46.5113V47H45.4183C44.7429 47 44.2364 46.8445 43.8987 46.5335C43.561 46.2224 43.3921 45.7114 43.3921 45.0005V40.6949H42.4457V39.6952H43.3921V37.8556H44.6052V39.6952H46.5113V40.6949H44.6052Z"
              fill="#FF008C"
            />
          </svg>

          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            onClick={() => {
              clearSelectedItem();
            }}
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.75781 17.2438L12.0008 12.0008L17.2438 17.2438M17.2438 6.75781L11.9998 12.0008L6.75781 6.75781"
              stroke="black"
              stroke-width="1.5"
              strokeLinecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
        <hr className="mt-4" />
      </div>

      {selectedItem && (
        <div key={selectedItem._id}>
          <div className="space-y-4 p-4  flex gap-3 items-end ">
            <div className="relative h-[144px] w-[196px] rounded-xl overflow-clip">
              <Image
                src={selectedItem.cover_image}
                alt="product image"
                fill
                className="absolute object-cover"
              />
            </div>
            <div className="flex gap-2 lg:gap-5">
              {selectedItem.images.map((image) => (
                <div
                  key={selectedItem._id}
                  className="w-[51px] h-[38px] overflow-clip relative bg-gray-400 rounded-lg"
                >
                  <Image
                    src={image}
                    alt="product image"
                    fill
                    className="absolute object-cover"
                  />
                </div>
              ))}
            </div>
          </div>
          <div className="lg:hidden p-4 ">
            <CartPopupProductDescription
              item={{ ...selectedItem, quantity: 0 }}
            />
          </div>
        </div>
      )}
    </div>
  );
}
